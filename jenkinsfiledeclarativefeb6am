#!/usr/bin/env grrovy
* Declarative pipeline must be enclosed within a pipeline block */
pipeline {
     /*agent section specifies where the entire Pipeline script will execute in the Jenkins environment */
    //agent any
	agent {
	
	label 'master'
	
	}
    
	/* Here we can declare the environemnt variables */
    environment {
      CF_VERSION = '1.0'
      CF_API = ''
      DEPLOY_ENV = "${params.environment}"
   }
    /**
     * tools to auto-install and put on the PATH
     * some of the supported tools - maven, jdk, gradle,git
     */
    tools {
        maven 'maven3.6.3' 
    }
    
    triggers {
   
     pollSCM('* * * * *')
    
   }
   
   
   // Configure Pipeline-specific options
   options {
      
       // Add timestamps to output
       timestamps()
       overrideIndexTriggers(false)
       // timeout job after 60 minutes
       timeout(time: 60,unit: 'MINUTES')
       // Keep only last 5 builds
       buildDiscarder(logRotator(artifactDaysToKeepStr: '', artifactNumToKeepStr: '5', daysToKeepStr: '', numToKeepStr: '5'))
       disableConcurrentBuilds()
   }
 
     /**
     * stages contain one or more stage directives
     */
    stages {
       
        
        stage('CheckoutCode') {
            steps {
                git branch: 'stage', credentialsId: 'fc8c3d87-2a92-4de9-9e00-c38f5e780b97', url: 'https://github.com/MithunTechnologiesDevOps/maven-web-application.git'
            
                sh "echo CF_VERSION ${CF_VERSION}"
            }
        }
        
        stage('MavenBuild') {
            steps {
               sh 'mvn clean package'
            }
        }
}
